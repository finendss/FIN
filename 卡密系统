-- 紫色主题卡密系统GUI + 右侧弹出通知系统 + 粒子特效 + 防抓包
-- 作者：HL团队
-- 修复卡顿版本

-- 系统配置
local Config = {
    ScriptName = "FIN-Hub卡密系统",
    Key = "Key_XingQing_FIN", -- 正确的卡密
    QQ = "123456789", -- 官方QQ群
    NoKeyMessage = "卡密错误，请加入主群获取", -- 卡密错误提示
    Version = "By 鑫晴"
}

-- 防抓包安全检测
local function SecurityCheck()
    local suspiciousGlobals = {
        "hookfunction", "hookfunc", "detour_function", "crypt",
        "getrawmetatable", "setrawmetatable", "getnamecallmethod",
        "HttpSpy", "HttpLogger", "PacketSniffer", "NetworkLogger"
    }
    
    local suspiciousTables = {
        debug = {"getinfo", "getupvalue", "setupvalue", "getregistry"},
        hookfunction = true,
        getrawmetatable = true
    }
    
    for _, globalName in ipairs(suspiciousGlobals) do
        if _G[globalName] ~= nil then
            return false, "检测到可疑环境"
        end
    end
    
    if debug then
        for _, funcName in ipairs(suspiciousTables.debug) do
            if debug[funcName] and type(debug[funcName]) == "function" then
                local funcInfo = debug.getinfo(debug[funcName])
                if funcInfo and funcInfo.short_src ~= "[C]" then
                    return false, "检测到调试环境"
                end
            end
        end
    end
    
    if hookfunction and type(hookfunction) == "function" then
        local funcInfo = debug.getinfo(hookfunction)
        if funcInfo and funcInfo.short_src ~= "[C]" then
            return false, "检测到Hook环境"
        end
    end
    
    if getrawmetatable and type(getrawmetatable) == "function" then
        local funcInfo = debug.getinfo(getrawmetatable)
        if funcInfo and funcInfo.short_src ~= "[C]" then
            return false, "检测到元表操作环境"
        end
    end
    
    return true, "环境安全"
end

-- 安全HTTP请求函数
local function SecureHttpGet(url)
    local success, result = pcall(function()
        local isSafe, reason = SecurityCheck()
        if not isSafe then
            error("安全检测失败: " .. reason)
        end
        
        local httpService = game:GetService("HttpService")
        local randomParam = "&t=" .. tostring(tick())
        local finalUrl = url .. randomParam
        return httpService:GetAsync(finalUrl)
    end)
    
    if success then
        return result
    else
        warn("安全HTTP请求失败: " .. tostring(result))
        return nil
    end
end

-- 反调试保护
local function AntiDebug()
    coroutine.wrap(function()
        while true do
            wait(math.random(5, 15))
            local isSafe, reason = SecurityCheck()
            if not isSafe then
                game.Players.LocalPlayer:Kick("安全检测失败: " .. reason)
                break
            end
        end
    end)()
end

AntiDebug()

-- 创建GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KeySystem_" .. tostring(math.random(10000, 99999))
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- 创建通知GUI
local NotificationsGui = Instance.new("ScreenGui")
NotificationsGui.Name = "Notifications_" .. tostring(math.random(10000, 99999))
NotificationsGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
NotificationsGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- 创建粒子背景GUI - 完全透明背景
local ParticlesGui = Instance.new("ScreenGui")
ParticlesGui.Name = "ParticlesBackground_" .. tostring(math.random(10000, 99999))
ParticlesGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ParticlesGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- 增强粒子系统 - 完全透明背景
local function createParticleSystem()
    local particles = {}
    local particleColors = {
        Color3.fromRGB(140, 90, 220),
        Color3.fromRGB(120, 70, 200),
        Color3.fromRGB(100, 50, 180),
        Color3.fromRGB(160, 110, 240),
        Color3.fromRGB(180, 130, 255),
        Color3.fromRGB(90, 40, 160),
        Color3.fromRGB(200, 150, 255),
        Color3.fromRGB(80, 30, 140)
    }
    
    for i = 1, 40 do -- 增加到35个粒子
        local particle = Instance.new("Frame")
        particle.Name = "Particle_" .. tostring(i)
        particle.Parent = ParticlesGui
        particle.BackgroundColor3 = particleColors[math.random(1, #particleColors)]
        particle.BorderSizePixel = 0
        particle.Size = UDim2.new(0, math.random(4, 12), 0, math.random(4, 12))
        particle.Position = UDim2.new(0, math.random(-100, 2000), 0, math.random(-100, 1200))
        particle.ZIndex = 0
        particle.BackgroundTransparency = 0.8 -- 更高透明度
        
        -- 圆角粒子
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(1, 0)
        corner.Parent = particle
        
        -- 粒子发光效果
        local glow = Instance.new("UIStroke")
        glow.Parent = particle
        glow.Color = particle.BackgroundColor3
        glow.Thickness = 2
        glow.Transparency = 0.7
        
        -- 粒子动画
        local speedX = math.random(-50, 50) / 10
        local speedY = math.random(-50, 50) / 10
        
        coroutine.wrap(function()
            while particle and particle.Parent do
                local currentPos = particle.Position
                local newX = currentPos.X.Offset + speedX
                local newY = currentPos.Y.Offset + speedY
                
                -- 边界检测
                if newX < -100 then newX = 2000
                elseif newX > 2000 then newX = -100 end
                
                if newY < -100 then newY = 1200
                elseif newY > 1200 then newY = -100 end
                
                particle.Position = UDim2.new(0, newX, 0, newY)
                
                -- 脉动效果
                local pulse = math.sin(tick() * 2 + i) * 0.2 + 0.8
                particle.BackgroundTransparency = 0.8 + (1 - pulse) * 0.15
                
                wait(0.02)
            end
        end)()
        
        table.insert(particles, particle)
    end
    
    -- 添加一些星光粒子
    for i = 1, 15 do
        local star = Instance.new("ImageLabel")
        star.Name = "Star_" .. tostring(i)
        star.Parent = ParticlesGui
        star.BackgroundTransparency = 1
        star.Image = "rbxassetid://9753762469" -- 星星图标
        star.ImageColor3 = Color3.fromRGB(180, 140, 255)
        star.Size = UDim2.new(0, math.random(8, 16), 0, math.random(8, 16))
        star.Position = UDim2.new(0, math.random(-100, 2000), 0, math.random(-100, 1200))
        star.ZIndex = 0
        star.ImageTransparency = 0.9
        
        coroutine.wrap(function()
            while star and star.Parent do
                -- 闪烁效果
                local blink = math.sin(tick() * 3 + i) * 0.5 + 0.5
                star.ImageTransparency = 0.9 - blink * 0.3
                wait(0.1)
            end
        end)()
    end
end

createParticleSystem()

-- 创建完全透明的背景
local BackgroundEffect = Instance.new("Frame")
BackgroundEffect.Name = "BackgroundEffect"
BackgroundEffect.Parent = ScreenGui
BackgroundEffect.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
BackgroundEffect.BackgroundTransparency = 1 -- 完全透明
BackgroundEffect.Size = UDim2.new(1, 0, 1, 0)
BackgroundEffect.ZIndex = 0

-- 主容器 - 玻璃拟态效果
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 15, 40)
MainFrame.BackgroundTransparency = 0.15
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.Size = UDim2.new(0, 420, 0, 380)
MainFrame.ZIndex = 2

-- 玻璃拟态效果
local GlassEffect = Instance.new("Frame")
GlassEffect.Name = "GlassEffect"
GlassEffect.Parent = MainFrame
GlassEffect.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
GlassEffect.BackgroundTransparency = 0.95
GlassEffect.Size = UDim2.new(1, 0, 1, 0)
GlassEffect.ZIndex = 1

-- 圆角
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 24)
UICorner.Parent = MainFrame

-- 边框效果 - 霓虹光效
local UIStroke = Instance.new("UIStroke")
UIStroke.Parent = MainFrame
UIStroke.Color = Color3.fromRGB(140, 90, 220)
UIStroke.Thickness = 3
UIStroke.Transparency = 0.3
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

-- 动态边框光效
coroutine.wrap(function()
    while MainFrame and MainFrame.Parent do
        local hue = tick() % 5 / 5
        local color = Color3.fromHSV(hue, 0.7, 1)
        UIStroke.Color = color:Lerp(Color3.fromRGB(140, 90, 220), 0.7)
        wait(0.1)
    end
end)()

-- 顶部标题栏
local TopBar = Instance.new("Frame")
TopBar.Name = "TopBar"
TopBar.Parent = MainFrame
TopBar.BackgroundColor3 = Color3.fromRGB(30, 20, 55)
TopBar.BackgroundTransparency = 0.2
TopBar.BorderSizePixel = 0
TopBar.Size = UDim2.new(1, 0, 0, 60)

local UICorner_2 = Instance.new("UICorner")
UICorner_2.CornerRadius = UDim.new(0, 24, 0, 0)
UICorner_2.Parent = TopBar

-- 顶部装饰线 - 流光效果
local TopAccent = Instance.new("Frame")
TopAccent.Name = "TopAccent"
TopAccent.Parent = TopBar
TopAccent.BackgroundColor3 = Color3.fromRGB(160, 110, 255)
TopAccent.BorderSizePixel = 0
TopAccent.Position = UDim2.new(0, 0, 1, -3)
TopAccent.Size = UDim2.new(1, 0, 0, 3)

local AccentGradient = Instance.new("UIGradient")
AccentGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(140, 90, 220)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(180, 130, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(140, 90, 220))
})
AccentGradient.Rotation = 0
AccentGradient.Parent = TopAccent

-- 流光动画
coroutine.wrap(function()
    while TopAccent and TopAccent.Parent do
        local offset = tick() % 3 / 3
        AccentGradient.Offset = Vector2.new(-offset, 0)
        wait(0.05)
    end
end)()

-- 标题文字
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Parent = TopBar
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 25, 0, 8)
Title.Size = UDim2.new(1, -50, 0, 28)
Title.Font = Enum.Font.GothamBlack
Title.Text = Config.ScriptName .. " - 卡密验证"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 20
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.TextStrokeTransparency = 0.8
Title.TextStrokeColor3 = Color3.fromRGB(80, 50, 140)

local Subtitle = Instance.new("TextLabel")
Subtitle.Name = "Subtitle"
Subtitle.Parent = TopBar
Subtitle.BackgroundTransparency = 1
Subtitle.Position = UDim2.new(0, 25, 0, 36)
Subtitle.Size = UDim2.new(1, -50, 0, 18)
Subtitle.Font = Enum.Font.Gotham
Subtitle.Text = "By 鑫晴" -- 修正文本
Subtitle.TextColor3 = Color3.fromRGB(200, 180, 240)
Subtitle.TextSize = 13
Subtitle.TextXAlignment = Enum.TextXAlignment.Left

-- 内容区域
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Parent = MainFrame
ContentFrame.BackgroundTransparency = 1
ContentFrame.Position = UDim2.new(0, 0, 0, 65)
ContentFrame.Size = UDim2.new(1, 0, 1, -65)

-- 卡密输入区域
local InputSection = Instance.new("Frame")
InputSection.Name = "InputSection"
InputSection.Parent = ContentFrame
InputSection.BackgroundTransparency = 1
InputSection.Position = UDim2.new(0, 30, 0, 25)
InputSection.Size = UDim2.new(1, -60, 0, 120)

local KeyLabel = Instance.new("TextLabel")
KeyLabel.Name = "KeyLabel"
KeyLabel.Parent = InputSection
KeyLabel.BackgroundTransparency = 1
KeyLabel.Size = UDim2.new(1, 0, 0, 30)
KeyLabel.Font = Enum.Font.GothamBold
KeyLabel.Text = "请输入FIN-Hub卡密以继续使用"
KeyLabel.TextColor3 = Color3.fromRGB(220, 210, 250)
KeyLabel.TextSize = 16
KeyLabel.TextXAlignment = Enum.TextXAlignment.Left

local KeyInput = Instance.new("TextBox")
KeyInput.Name = "KeyInput"
KeyInput.Parent = InputSection
KeyInput.BackgroundColor3 = Color3.fromRGB(25, 20, 45)
KeyInput.BackgroundTransparency = 0.2
KeyInput.BorderSizePixel = 0
KeyInput.Position = UDim2.new(0, 0, 0, 35)
KeyInput.Size = UDim2.new(1, 0, 0, 50)
KeyInput.Font = Enum.Font.Gotham
KeyInput.PlaceholderColor3 = Color3.fromRGB(130, 110, 180)
KeyInput.PlaceholderText = "在此处输入您的卡密"
KeyInput.Text = ""
KeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
KeyInput.TextSize = 17
KeyInput.ClearTextOnFocus = false

local UICorner_3 = Instance.new("UICorner")
UICorner_3.CornerRadius = UDim.new(0, 14)
UICorner_3.Parent = KeyInput

-- 输入框边框
local InputStroke = Instance.new("UIStroke")
InputStroke.Parent = KeyInput
InputStroke.Color = Color3.fromRGB(100, 75, 160)
InputStroke.Thickness = 2
InputStroke.Transparency = 0.2

-- 输入框光效
local InputGlow = Instance.new("ImageLabel")
InputGlow.Name = "InputGlow"
InputGlow.Parent = KeyInput
InputGlow.BackgroundTransparency = 1
InputGlow.Size = UDim2.new(1, 20, 1, 20)
InputGlow.Position = UDim2.new(0, -10, 0, -10)
InputGlow.Image = "rbxassetid://8992231221"
InputGlow.ImageColor3 = Color3.fromRGB(80, 50, 140)
InputGlow.ImageTransparency = 0.9
InputGlow.ScaleType = Enum.ScaleType.Slice
InputGlow.SliceCenter = Rect.new(100, 100, 100, 100)
InputGlow.ZIndex = -1

local InputHint = Instance.new("TextLabel")
InputHint.Name = "InputHint"
InputHint.Parent = InputSection
InputHint.BackgroundTransparency = 1
InputHint.Position = UDim2.new(0, 0, 0, 90)
InputHint.Size = UDim2.new(1, 0, 0, 20)
InputHint.Font = Enum.Font.Gotham
InputHint.Text = "请输入卡密"
InputHint.TextColor3 = Color3.fromRGB(150, 130, 200)
InputHint.TextSize = 12
InputHint.TextXAlignment = Enum.TextXAlignment.Left

-- 按钮区域
local ButtonSection = Instance.new("Frame")
ButtonSection.Name = "ButtonSection"
ButtonSection.Parent = ContentFrame
ButtonSection.BackgroundTransparency = 1
ButtonSection.Position = UDim2.new(0, 30, 0, 165)
ButtonSection.Size = UDim2.new(1, -60, 0, 60)

local VerifyButton = Instance.new("TextButton")
VerifyButton.Name = "VerifyButton"
VerifyButton.Parent = ButtonSection
VerifyButton.BackgroundColor3 = Color3.fromRGB(120, 80, 210)
VerifyButton.BackgroundTransparency = 0.1
VerifyButton.BorderSizePixel = 0
VerifyButton.Position = UDim2.new(0, 0, 0, 0)
VerifyButton.Size = UDim2.new(0.48, 0, 1, 0)
VerifyButton.Font = Enum.Font.GothamBlack
VerifyButton.Text = "验证"
VerifyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
VerifyButton.TextSize = 17
VerifyButton.AutoButtonColor = false

local UICorner_4 = Instance.new("UICorner")
UICorner_4.CornerRadius = UDim.new(0, 14)
UICorner_4.Parent = VerifyButton

-- 验证按钮渐变效果
local VerifyGradient = Instance.new("UIGradient")
VerifyGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(130, 90, 220)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(110, 70, 190))
})
VerifyGradient.Rotation = 90
VerifyGradient.Parent = VerifyButton

-- 按钮光效
local ButtonGlow = Instance.new("ImageLabel")
ButtonGlow.Name = "ButtonGlow"
ButtonGlow.Parent = VerifyButton
ButtonGlow.BackgroundTransparency = 1
ButtonGlow.Size = UDim2.new(1, 20, 1, 20)
ButtonGlow.Position = UDim2.new(0, -10, 0, -10)
ButtonGlow.Image = "rbxassetid://8992231221"
ButtonGlow.ImageColor3 = Color3.fromRGB(140, 100, 230)
ButtonGlow.ImageTransparency = 0.9
ButtonGlow.ScaleType = Enum.ScaleType.Slice
ButtonGlow.SliceCenter = Rect.new(100, 100, 100, 100)
ButtonGlow.ZIndex = -1

local ExitButton = Instance.new("TextButton")
ExitButton.Name = "ExitButton"
ExitButton.Parent = ButtonSection
ExitButton.BackgroundColor3 = Color3.fromRGB(45, 35, 75)
ExitButton.BackgroundTransparency = 0.2
ExitButton.BorderSizePixel = 0
ExitButton.Position = UDim2.new(0.52, 0, 0, 0)
ExitButton.Size = UDim2.new(0.48, 0, 1, 0)
ExitButton.Font = Enum.Font.GothamBold
ExitButton.Text = "退出"
ExitButton.TextColor3 = Color3.fromRGB(220, 210, 250)
ExitButton.TextSize = 16
ExitButton.AutoButtonColor = false

local UICorner_5 = Instance.new("UICorner")
UICorner_5.CornerRadius = UDim.new(0, 14)
UICorner_5.Parent = ExitButton

-- 底部区域
local BottomSection = Instance.new("Frame")
BottomSection.Name = "BottomSection"
BottomSection.Parent = ContentFrame
BottomSection.BackgroundTransparency = 1
BottomSection.Position = UDim2.new(0, 30, 0, 245)
BottomSection.Size = UDim2.new(1, -60, 0, 80)

local CopyGroupButton = Instance.new("TextButton")
CopyGroupButton.Name = "CopyGroupButton"
CopyGroupButton.Parent = BottomSection
CopyGroupButton.BackgroundColor3 = Color3.fromRGB(40, 30, 65)
CopyGroupButton.BackgroundTransparency = 0.2
CopyGroupButton.BorderSizePixel = 0
CopyGroupButton.Size = UDim2.new(1, 0, 0, 45)
CopyGroupButton.Font = Enum.Font.Gotham
CopyGroupButton.Text = "复制官方群号"
CopyGroupButton.TextColor3 = Color3.fromRGB(200, 190, 240)
CopyGroupButton.TextSize = 15
CopyGroupButton.AutoButtonColor = false

local UICorner_6 = Instance.new("UICorner")
UICorner_6.CornerRadius = UDim.new(0, 12)
UICorner_6.Parent = CopyGroupButton

-- 按钮图标
local CopyIcon = Instance.new("TextLabel")
CopyIcon.Name = "CopyIcon"
CopyIcon.Parent = CopyGroupButton
CopyIcon.BackgroundTransparency = 1
CopyIcon.Position = UDim2.new(0, 15, 0, 0)
CopyIcon.Size = UDim2.new(0, 45, 1, 0)
CopyIcon.Font = Enum.Font.GothamBold
CopyIcon.Text = "📋"
CopyIcon.TextColor3 = Color3.fromRGB(180, 150, 230)
CopyIcon.TextSize = 18
CopyIcon.TextXAlignment = Enum.TextXAlignment.Left

local VersionLabel = Instance.new("TextLabel")
VersionLabel.Name = "VersionLabel"
VersionLabel.Parent = BottomSection
VersionLabel.BackgroundTransparency = 1
VersionLabel.Position = UDim2.new(0, 0, 0, 50)
VersionLabel.Size = UDim2.new(1, 0, 0, 25)
VersionLabel.Font = Enum.Font.Gotham
VersionLabel.Text = Config.Version
VersionLabel.TextColor3 = Color3.fromRGB(120, 100, 170)
VersionLabel.TextSize = 12
VersionLabel.TextXAlignment = Enum.TextXAlignment.Center

-- 按钮交互效果
local function createButtonEffect(button)
    local originalSize = button.Size
    
    -- 悬停效果
    button.MouseEnter:Connect(function()
        game:GetService("TweenService"):Create(
            button,
            TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {
                BackgroundTransparency = button == VerifyButton and 0.05 or 0.1,
                Size = originalSize + UDim2.new(0, 4, 0, 4)
            }
        ):Play()
        
        if button == VerifyButton then
            game:GetService("TweenService"):Create(
                ButtonGlow,
                TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {ImageTransparency = 0.7}
            ):Play()
        end
    end)
    
    button.MouseLeave:Connect(function()
        game:GetService("TweenService"):Create(
            button,
            TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {
                BackgroundTransparency = button == VerifyButton and 0.1 or 0.2,
                Size = originalSize
            }
        ):Play()
        
        if button == VerifyButton then
            game:GetService("TweenService"):Create(
                ButtonGlow,
                TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {ImageTransparency = 0.9}
            ):Play()
        end
    end)
    
    -- 点击效果
    button.MouseButton1Down:Connect(function()
        game:GetService("TweenService"):Create(
            button,
            TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Size = originalSize - UDim2.new(0, 4, 0, 4)}
        ):Play()
    end)
    
    button.MouseButton1Up:Connect(function()
        game:GetService("TweenService"):Create(
            button,
            TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Size = originalSize}
        ):Play()
    end)
end

-- 应用按钮效果
createButtonEffect(VerifyButton)
createButtonEffect(ExitButton)
createButtonEffect(CopyGroupButton)

-- 输入框焦点效果
KeyInput.Focused:Connect(function()
    game:GetService("TweenService"):Create(
        KeyInput,
        TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {BackgroundTransparency = 0.1}
    ):Play()
    
    game:GetService("TweenService"):Create(
        InputStroke,
        TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {Color = Color3.fromRGB(160, 120, 240)}
    ):Play()
    
    game:GetService("TweenService"):Create(
        InputGlow,
        TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {ImageTransparency = 0.8}
    ):Play()
end)

KeyInput.FocusLost:Connect(function()
    game:GetService("TweenService"):Create(
        KeyInput,
        TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {BackgroundTransparency = 0.2}
    ):Play()
    
    game:GetService("TweenService"):Create(
        InputStroke,
        TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {Color = Color3.fromRGB(100, 75, 160)}
    ):Play()
    
    game:GetService("TweenService"):Create(
        InputGlow,
        TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {ImageTransparency = 0.9}
    ):Play()
end)

-- 自定义通知系统 - 优化版（更小、更透明、圆角）
local notificationQueue = {}
local activeNotifications = 0
local maxNotifications = 3

local function showNotification(title, message, notificationType, duration)
    duration = duration or 3
    
    while activeNotifications >= maxNotifications do
        wait(0.5)
    end
    
    activeNotifications = activeNotifications + 1
    
    local verticalOffset = (activeNotifications - 1) * 70 -- 减小间距
    
    -- 创建通知框架
    local NotificationFrame = Instance.new("Frame")
    NotificationFrame.Name = "Notification"
    NotificationFrame.Parent = NotificationsGui
    NotificationFrame.AnchorPoint = Vector2.new(1, 0)
    NotificationFrame.BackgroundColor3 = Color3.fromRGB(25, 20, 45)
    NotificationFrame.BackgroundTransparency = 0.4 -- 更透明
    NotificationFrame.BorderSizePixel = 0
    NotificationFrame.Position = UDim2.new(1, 10, 0, 20 + verticalOffset)
    NotificationFrame.Size = UDim2.new(0, 0, 0, 60) -- 更小高度
    NotificationFrame.ZIndex = 10
    
    -- 通知圆角 - 更大的圆角
    local NotificationCorner = Instance.new("UICorner")
    NotificationCorner.CornerRadius = UDim.new(0, 20) -- 增加圆角半径
    NotificationCorner.Parent = NotificationFrame
    
    -- 通知边框
    local NotificationStroke = Instance.new("UIStroke")
    NotificationStroke.Parent = NotificationFrame
    NotificationStroke.Color = Color3.fromRGB(100, 75, 170)
    NotificationStroke.Thickness = 2
    NotificationStroke.Transparency = 0.5 -- 更透明
    
    -- 通知左侧装饰条
    local NotificationAccent = Instance.new("Frame")
    NotificationAccent.Parent = NotificationFrame
    NotificationAccent.BackgroundColor3 = notificationType == "success" and Color3.fromRGB(100, 220, 140) or Color3.fromRGB(220, 100, 100)
    NotificationAccent.BorderSizePixel = 0
    NotificationAccent.Position = UDim2.new(0, 0, 0, 0)
    NotificationAccent.Size = UDim2.new(0, 5, 1, 0)
    
    local AccentCorner = Instance.new("UICorner")
    AccentCorner.CornerRadius = UDim.new(0, 20, 0, 20) -- 增加圆角半径
    AccentCorner.Parent = NotificationAccent
    
    -- 通知图标
    local NotificationIcon = Instance.new("TextLabel")
    NotificationIcon.Parent = NotificationFrame
    NotificationIcon.BackgroundTransparency = 1
    NotificationIcon.Position = UDim2.new(0, 12, 0, 10) -- 调整位置
    NotificationIcon.Size = UDim2.new(0, 25, 0, 25) -- 更小图标
    NotificationIcon.Font = Enum.Font.GothamBlack
    NotificationIcon.Text = notificationType == "success" and "✓" or "✗"
    NotificationIcon.TextColor3 = notificationType == "success" and Color3.fromRGB(100, 220, 140) or Color3.fromRGB(220, 100, 100)
    NotificationIcon.TextSize = 16 -- 更小字体
    
    -- 通知标题
    local NotificationTitle = Instance.new("TextLabel")
    NotificationTitle.Parent = NotificationFrame
    NotificationTitle.BackgroundTransparency = 1
    NotificationTitle.Position = UDim2.new(0, 45, 0, 8) -- 调整位置
    NotificationTitle.Size = UDim2.new(1, -55, 0, 18) -- 调整尺寸
    NotificationTitle.Font = Enum.Font.GothamBold
    NotificationTitle.Text = title
    NotificationTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    NotificationTitle.TextSize = 14 -- 更小字体
    NotificationTitle.TextXAlignment = Enum.TextXAlignment.Left
    
    -- 通知消息
    local NotificationMessage = Instance.new("TextLabel")
    NotificationMessage.Parent = NotificationFrame
    NotificationMessage.BackgroundTransparency = 1
    NotificationMessage.Position = UDim2.new(0, 45, 0, 26) -- 调整位置
    NotificationMessage.Size = UDim2.new(1, -55, 0, 26) -- 调整尺寸
    NotificationMessage.Font = Enum.Font.Gotham
    NotificationMessage.Text = message
    NotificationMessage.TextColor3 = Color3.fromRGB(210, 200, 240)
    NotificationMessage.TextSize = 11 -- 更小字体
    NotificationMessage.TextXAlignment = Enum.TextXAlignment.Left
    NotificationMessage.TextYAlignment = Enum.TextYAlignment.Top
    NotificationMessage.TextWrapped = true
    
    -- 进度条
    local ProgressBar = Instance.new("Frame")
    ProgressBar.Parent = NotificationFrame
    ProgressBar.BackgroundColor3 = notificationType == "success" and Color3.fromRGB(80, 200, 120) or Color3.fromRGB(200, 80, 80)
    ProgressBar.BorderSizePixel = 0
    ProgressBar.Position = UDim2.new(0, 0, 1, -3)
    ProgressBar.Size = UDim2.new(1, 0, 0, 3)
    
    local ProgressCorner = Instance.new("UICorner")
    ProgressCorner.CornerRadius = UDim.new(0, 0, 0, 20) -- 增加圆角半径
    ProgressCorner.Parent = ProgressBar
    
    -- 动画效果
    local TweenService = game:GetService("TweenService")
    
    -- 从右侧滑入动画
    local slideInTween = TweenService:Create(
        NotificationFrame,
        TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
        {Size = UDim2.new(0, 260, 0, 60), Position = UDim2.new(1, -15, 0, 20 + verticalOffset)} -- 更小宽度
    )
    slideInTween:Play()
    
    -- 进度条动画
    local progressTween = TweenService:Create(
        ProgressBar,
        TweenInfo.new(duration, Enum.EasingStyle.Linear),
        {Size = UDim2.new(0, 0, 0, 3)}
    )
    
    wait(0.5)
    progressTween:Play()
    wait(duration)
    
    -- 滑出动画
    local slideOutTween = TweenService:Create(
        NotificationFrame,
        TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In),
        {Size = UDim2.new(0, 0, 0, 60), Position = UDim2.new(1, 10, 0, 20 + verticalOffset)}
    )
    slideOutTween:Play()
    
    wait(0.4)
    NotificationFrame:Destroy()
    activeNotifications = activeNotifications - 1
end

-- 按钮功能
VerifyButton.MouseButton1Click:Connect(function()
    local isSafe, reason = SecurityCheck()
    if not isSafe then
        showNotification("警告", "检测到Spy或Hook，已停止", "error", 3)
        return
    end
    
    if KeyInput.Text == Config.Key then
        -- 立即显示成功通知，但不阻塞
        showNotification("验证成功", Config.ScriptName .. "已激活", "success", 1) -- 缩短为1秒
        
        -- 立即开始销毁动画，不等待
        local tween = game:GetService("TweenService"):Create(
            MainFrame,
            TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), -- 缩短动画时间
            {Size = UDim2.new(0, 0, 0, 0), BackgroundTransparency = 1}
        )
        tween:Play()
        
        -- 使用延迟销毁，不阻塞主线程
        delay(0.3, function()
            if ScreenGui then ScreenGui:Destroy() end
            if ParticlesGui then ParticlesGui:Destroy() end
        end)
        
        -- 立即加载脚本，不等待任何动画
        -- 脚本从这里开始执行（使用安全HTTP请求）
        -- local scriptContent = SecureHttpGet("https://pandadevelopment.net/virtual/file/b4386787b6e41afc")
        -- if scriptContent then
        --     loadstring(scriptContent)()
        -- end
        
    else
        local originalPosition = KeyInput.Position
        local tween1 = game:GetService("TweenService"):Create(
            KeyInput,
            TweenInfo.new(0.1, Enum.EasingStyle.Sine, Enum.EasingDirection.Out, 0, true),
            {Position = originalPosition + UDim2.new(0, 8, 0, 0)}
        )
        tween1:Play()
        
        KeyInput.BackgroundColor3 = Color3.fromRGB(80, 30, 60)
        KeyInput.UIStroke.Color = Color3.fromRGB(200, 80, 120)
        
        -- 立即踢出，不等待通知
        game.Players.LocalPlayer:Kick(Config.NoKeyMessage)
    end
end)

ExitButton.MouseButton1Click:Connect(function()
    local tween = game:GetService("TweenService"):Create(
        MainFrame,
        TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In),
        {Size = UDim2.new(0, 0, 0, 0), BackgroundTransparency = 1}
    )
    tween:Play()
    
    delay(0.3, function()
        if ScreenGui then ScreenGui:Destroy() end
        if ParticlesGui then ParticlesGui:Destroy() end
        if NotificationsGui then NotificationsGui:Destroy() end
    end)
end)

CopyGroupButton.MouseButton1Click:Connect(function()
    local isSafe, reason = SecurityCheck()
    if not isSafe then
        showNotification("警告", "检测到Spy或Hook，不加载脚本", "error", 3)
        return
    end
    
    if setclipboard then
        setclipboard(Config.QQ)
    end
    
    local originalText = CopyGroupButton.Text
    CopyGroupButton.Text = "已复制!"
    
    showNotification("已复制", "官方群号已复制到剪贴板", "success", 3)
    
    wait(1.5)
    CopyGroupButton.Text = originalText
end)

-- 添加淡入动画
local TweenService = game:GetService("TweenService")
MainFrame.BackgroundTransparency = 1
MainFrame.Size = UDim2.new(0, 0, 0, 0)
BackgroundEffect.BackgroundTransparency = 1

wait(0.1)

-- 背景淡入（保持完全透明）
local bgFadeIn = TweenService:Create(
    BackgroundEffect,
    TweenInfo.new(0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    {BackgroundTransparency = 1} -- 保持完全透明
)
bgFadeIn:Play()

-- 主框架动画
local mainFadeIn = TweenService:Create(
    MainFrame,
    TweenInfo.new(0.7, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
    {BackgroundTransparency = 0.15, Size = UDim2.new(0, 420, 0, 380)}
)
mainFadeIn:Play()

-- 初始显示通知
wait(1)
showNotification("欢迎", "请输入卡密使用FIN-Hub", "success", 3)
